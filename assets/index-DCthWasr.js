(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))d(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&d(a)}).observe(document,{childList:!0,subtree:!0});function c(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function d(o){if(o.ep)return;o.ep=!0;const n=c(o);fetch(o.href,n)}})();if(!window.cv)alert("OpenCV.jsのロードに失敗しました。ページを再読み込みしてください。"),console.error("cv is not defined");else{let u=function(){c.width=t.videoWidth,c.height=t.videoHeight;const i=new e.Mat(t.height,t.width,e.CV_8UC4),r=new e.Mat(t.height,t.width,e.CV_8UC3),s=new e.Mat(t.height,t.width,e.CV_8UC1),w=new e.Mat(r.rows,r.cols,r.type(),[35,40,40,0]),f=new e.Mat(r.rows,r.cols,r.type(),[85,255,255,255]);o.textContent="異常検知を実行中...",g();function g(){try{n.drawImage(t,0,0,t.width,t.height),i.data.set(n.getImageData(0,0,t.width,t.height).data),e.cvtColor(i,r,e.COLOR_RGBA2RGB),e.cvtColor(r,r,e.COLOR_RGB2HSV),e.inRange(r,w,f,s),e.bitwise_not(s,s);const l=new e.Scalar(0,0,0,255);i.setTo(l),n.drawImage(t,0,0,t.width,t.height);const h=new e.Mat(t.height,t.width,e.CV_8UC4);h.data.set(n.getImageData(0,0,t.width,t.height).data),h.copyTo(i,s);const p=e.countNonZero(s),y=s.rows*s.cols,v=p/y*100;d.textContent=v.toFixed(2),e.imshow("canvasOutput",i),h.delete()}catch(l){console.error("フレーム処理中にエラーが発生:",l)}requestAnimationFrame(g)}};var C=u;const e=window.cv,t=document.getElementById("video"),c=document.getElementById("canvasOutput"),d=document.getElementById("detectionRate"),o=document.getElementById("status"),n=c.getContext("2d");o.textContent="カメラの準備をしています...";const a={video:{width:640,height:480,facingMode:"environment"}};async function m(){try{const i=await navigator.mediaDevices.getUserMedia(a);t.srcObject=i,await t.play(),o.textContent="OpenCVを初期化中...",u()}catch(i){console.error("カメラのアクセスに失敗しました: ",i),o.textContent="エラー: カメラにアクセスできませんでした。",alert("カメラにアクセスできませんでした。")}}m()}
